<!DOCTYPE html>
<html lang="en" dir="zh"><head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=1"
/>
<meta
  http-equiv="Content-Security-Policy"
  content="upgrade-insecure-requests"
/>
<title>
   zerotier 异地组网 - 大个子斌斌子
  
</title>

<meta name="keywords" content="" />
  <meta property="og:title" content="zerotier 异地组网"/>
<meta property="og:site_name" content="大个子斌斌子" />
<meta property="og:image" content="/favicon-32x32.png" />
<meta name="title" content="zerotier 异地组网 - 大个子斌斌子" /> 
<meta name="description" content="" />

<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png" />
<link
  rel="icon"
  type="image/png"
  sizes="192x192"
  href="/android-icon-192x192.png"
/>
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />

<link rel="stylesheet" href="/scss/zero.min.6fd76f5e3ba2e8ba1ef657cc3d770acbc02c87134af726c90f562cd07981fc96.css">


<script data-ad-client="ca-pub-0142417710587136" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

</head>
<body>
  <header>
    <div class="header-inner"><div id="site-header" class="header-wrap">
    <div class="title">
        
        <a href="/">大个子斌斌子</a>
        
         &nbsp;|&nbsp; 慢慢浇水，等待，发芽，长大！
    </div>
</div>

<div id="post-header" class="header-wrap">
    <div class="title">zerotier 异地组网</div>
</div>

</div>
    <div class="header-band"></div>
  </header>
  <main id="main">
    <div class="main-inner">
      <div class="content-wrap">
        <div id="main-content" class="main-content">
<article>
  
  <h2 id="post-title">zerotier 异地组网</h2>
  
  <div class="post-mate">
  
  <span class="post-date">
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
    <path d="M13.294 1.412h-1.44V.6a.6.6 0 1 0-1.2 0v.812H5.346V.6a.6.6 0 1 0-1.2 0v.812h-1.44c-1.1 0-2 .9-2 2V14c0 1.1.9 2 2 2h10.588c1.1 0 2-.9 2-2V3.412c0-1.1-.9-2-2-2m0 13.388H2.706a.81.81 0 0 1-.8-.8V6.282h12.188V14a.81.81 0 0 1-.8.8M2.706 2.612h1.44v.426a.6.6 0 0 0 1.2 0v-.426h5.308v.426a.6.6 0 1 0 1.2 0v-.426h1.44c.434 0 .8.366.8.8v1.67H1.906v-1.67c0-.434.366-.8.8-.8"/>
</svg>
</i>
<time>
      2022-06-03
    </time>
  </span>
  
  
  
  <span class="post-category">
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
    <path d="M14.4 3.4h-1.88l-.247-1.139A1.599 1.599 0 0 0 10.709 1H1.6A1.6 1.6 0 0 0 0 2.6V13a1.6 1.6 0 0 0 1.6 1.6h12.8A1.6 1.6 0 0 0 16 13V5a1.6 1.6 0 0 0-1.6-1.6m.4 9.6a.4.4 0 0 1-.4.4H1.6a.4.4 0 0 1-.4-.4V2.6a.4.4 0 0 1 .4-.4h5.109c.187 0 .352.133.391.315l.247 1.139A1.2 1.2 0 0 0 8.52 4.6h5.88a.4.4 0 0 1 .4.4v8M11.1 2.515l.192.885H8.52l-.247-1.139c-.005-.022-.019-.039-.025-.061h2.461c.187 0 .352.133.391.315"/>
</svg>
</i>

    <span>
      <a href="/categories/zerotier" itemprop="url" rel="index">
        zerotier
      </a>
      &nbsp;
    </span>
    
  </span>
  
  
  
  
  
  <span class="post-count">
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
    <path d="M15.578 2.478L13.52.421a1.441 1.441 0 0 0-2.037 0L1.405 10.5a1.355 1.355 0 0 0-.357.632l-1.03 4.123a.598.598 0 0 0 .727.726l4.12-1.03c.241-.059.462-.184.636-.36L15.578 4.518a1.444 1.444 0 0 0 0-2.039M2.084 12.017L4 13.931l-2.569.643.654-2.557m2.98 1.284l-2.382-2.383 7.561-7.56 2.394 2.395L5.064 13.3m9.665-9.633l-1.242 1.239-2.396-2.396 1.241-1.24a.237.237 0 0 1 .34 0l2.057 2.056a.241.241 0 0 1 0 .341"/>
</svg>
</i>
158字</span>
  
  <span class="post-readtime">
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
    <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0m0 1.2c3.75 0 6.8 3.05 6.8 6.8s-3.05 6.8-6.8 6.8S1.2 11.75 1.2 8 4.25 1.2 8 1.2m3.296 9.733a.59.59 0 0 1-.299-.081l-3.656-2.11a.598.598 0 0 1-.3-.52V4.626a.6.6 0 1 1 1.2 0v3.25l3.355 1.938a.6.6 0 0 1-.3 1.12"/>
</svg>
</i>
≈1
  </span>
  
</div>

  
  <div class="markdown-body post-body"><p>最近使用zerotier替换了frp来实现内网穿透，zerotier是一个软交换机，使用zerotier可以让多台内网机器组成一个局域网。</p>
<p>首先要安装 zerotier-one 这个软件包，如果是ArchLinux，直接运行：</p>
<pre tabindex="0"><code>$ sudo pacman -S zerotier-one
</code></pre><p>如果是Ubuntu/Debian/CentOS，则运行：</p>
<pre tabindex="0"><code>$ curl -s https://install.zerotier.com/ | sudo bash
</code></pre><p>注：如果是Windows或者macOS、Android、iOS等，那么可以在 <a href="https://www.zerotier.com/download/">https://www.zerotier.com/download/</a> 下载zerotier
之后就完成了安装，然后我们要启动zerotier，并且让他开机自启动，运行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo systemctl start zerotier-one.service
</span></span><span class="line"><span class="cl">$ sudo systemctl <span class="nb">enable</span> zerotier-one.service
</span></span></code></pre></div><p>例如我有两台内网机器，于是都按照上面的描述进行了安装和启动。接下来要做的事情是到 <a href="https://my.zerotier.com/">https://my.zerotier.com/</a> 里注册帐号并且登录，然后创建一个Network，创建之后点到这个网络里，拉到最上面，选择 Private(私有网络) ，这样别人加入的时候就需要认证， 如果想改名字的话，改个名字，其他不用动。然后复制 Network ID，就是拉到最上面的时候可以看到的一个类似 82048a0632246d2c 的字符串。</p>
<p>然后在两台内网机器上执行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo zerotier-cli join xxxxxxxxxxxxxxx
</span></span></code></pre></div><p>加入之后他们就启动了，但是还连不进我们创建的网络，因为我们选择了 Private(私有网络) ，我们还需要到 <a href="https://my.zerotier.com/">https://my.zerotier.com/</a> 上面对接入的机器打勾，拉到 Members 这一节，把前面的两个勾勾选上。</p>
<p>这个时候执行一下 ip a 你会发现多了一个叫做 ztuzethlza 或者类似名字的设备，还有IP地址，这就是zerotier组建的局域网的IP 地址，但是这个时候你如果直接连接另外一台机器的话可能会非常慢，所以为了加速，我们还需要一台在国内的，或者是在国外但是访问 速度相当快的机器做转发。</p>
<p>搭建中转机器(moon)
首先把中转机器按照上述步骤一起加入网络，然后执行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> /var/lib/zerotier-one/
</span></span><span class="line"><span class="cl">$ sudo zerotier-idtool initmoon identity.public &gt; moon.json
</span></span></code></pre></div><p>接下来编辑一下 moon.json，把 &ldquo;stableEndpoints&rdquo;: [] 这一节里加入中转机器的公网IP，例如 &ldquo;stableEndpoints&rdquo;: [&ldquo;1.2.3.4/9993&rdquo;]，其中 9993是默认监听的端口，接下来要把9993端口的防火墙放开(注意是UDP)，如果你的机器外边还有防火墙的话，也要一起放开，例如阿里云的机器就有 防火墙规则，要一起把对应端口的UDP流量放行，此后，我们要生成moon的配置：</p>
<p><strong>注意</strong>打开 9993/udp  防火墙，我使用的是 腾讯云的云服务器版本（centos，默认系统防护墙是关闭的）,需要在云控制台中打开端口
使用 云 服务的可用在云控制台中打开</p>
<pre tabindex="0"><code>$ sudo zerotier-idtool genmoon moon.json
$ sudo mkdir moons.d  # 目录 并将生成的 *.moon 文件拷贝到 moons.d 中  
$ mv *.moon moons.d
</code></pre><p>接下来把中转服务器的 zerotier-one 重启：</p>
<pre tabindex="0"><code>$ sudo systemctl restart zerotier-one
$ sudo zerotier-cli listmoons # 验证moon是否添加成功
</code></pre><p>加入moon
注意我们搭建moon的时候有一个 moon.json，我们把内网机器加入这个moon的时候，需要其中的一个id：</p>
<pre tabindex="0"><code># 查看 moon id
$ cat /var/lib/zerotier-one/moon.json | grep \&#34;id\&#34; | cut -d &#39;&#34;&#39; -f4 | head -n 1
$ xxxxxxxxx
</code></pre><p>复制这个id，然后在内网机器执行：</p>
<pre tabindex="0"><code>$ sudo zerotier-cli orbit xxxxxxxxxx xxxxxxxx
</code></pre><p>注意，xxxxxxxxxx 要两遍。此后重启 zerotier，完毕。等一会儿之后，zerotier局域网内的机器就可以互相访问了，延时非常低：</p>
</div>
  
  
<section id="post-copyright">
  <dl>
    <dt><span>本文链接：</span>/posts/zerotier/start/</dt>
    <dt><span>本文作者：</span>大个子斌斌子</dt>
    <dt>
      <span>版权声明：</span>本博客文章除特别声明外，均采用
      <a
        href="https://creativecommons.org/licenses/by-nc-sa/3.0/"
        target="_blank"
        style="text-decoration: underline"
        ><abbr>&nbsp;CC BY-NC-SA 3.0&nbsp;</abbr></a
      >许可协议，转载请注明出处！
    </dt>
  </dl>
</section>


  
  <section id="post-donate">
  <div>
    <p class="donate-message">“感谢您请我喝茶”</p>
    <div class="donate-way">
      <div class="donate-item">
        <img width="188" src="/images/donate_ali.png" alt="支付宝" />
        <div><cite>支付宝</cite></div>
      </div>
      <div class="donate-item">
        <img width="188" src="/images/donate_wx.png" alt="微信" />
        <div><cite>微信</cite></div>
      </div>
    </div>
  </div>
</section>

  
  <div class="tags">
  <ul>
    
  </ul>
</div>

  
  <div class="paginate">
  
  
  <div class="prev">
    <a href="/posts/opencv/opencv-scan-color/">
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Pro 5.15.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) --><path d="M231.293 473.899l19.799-19.799c4.686-4.686 4.686-12.284 0-16.971L70.393 256 251.092 74.87c4.686-4.686 4.686-12.284 0-16.971L231.293 38.1c-4.686-4.686-12.284-4.686-16.971 0L4.908 247.515c-4.686 4.686-4.686 12.284 0 16.971L214.322 473.9c4.687 4.686 12.285 4.686 16.971-.001z"/></svg></i>
OpenCV 颜色识别
    </a>
  </div>
  
  <div class="paginate-divider"></div>
  
  <div class="next">
    <a href="/posts/golang/start/">
      快速入门 Go lang
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Pro 5.15.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) --><path d="M24.707 38.101L4.908 57.899c-4.686 4.686-4.686 12.284 0 16.971L185.607 256 4.908 437.13c-4.686 4.686-4.686 12.284 0 16.971L24.707 473.9c4.686 4.686 12.284 4.686 16.971 0l209.414-209.414c4.686-4.686 4.686-12.284 0-16.971L41.678 38.101c-4.687-4.687-12.285-4.687-16.971 0z"/></svg></i>
</a>
  </div>
  
</div>

  
   

</section>
</div>
      </div><aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">
    <section class="sidebar-wrap">
  <nav class="site-nav">
    <div id="menu" class="menu-list">
      
      
      
      
      <div class="menu-item ">
        <a href="/" rel="section" >
          首页
        </a>
      </div>
      
      
      
      <div class="menu-item ">
        <a href="/posts" rel="section" >
          归档
        </a>
      </div>
      
    </div>
  </nav>
</section>

    
<section class="sidebar-wrap">
  <div class="site-info">
    <div class="site-logo">
      <img width="96" src="/images/logo.png" />
    </div>
    <div><strong> 大个子斌斌子</strong></div>
    
    <p>慢慢浇水，等待，发芽，长大！</p>
    
    <div class="site-statis">
      <div class="statis-number">
        <strong class="number">12</strong>
        <div><small>日志</small></div>
      </div>
      <div class="statis-number">
        <strong class="number">4</strong>
        <div><small>分类</small></div>
      </div>
      <div class="statis-number">
        <strong class="number">1</strong>
        <div><small>标签</small></div>
      </div>
    </div>
    <div class="site-rss">
      <a href="/index.xml" target="_black">
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
    <path d="M0 11.661V16h4.348c0-.625-.104-1.215-.278-1.735a5.428 5.428 0 0 0-.94-1.389 5.978 5.978 0 0 0-1.39-.902A4.696 4.696 0 0 0 0 11.66zm0-5.83v2.88c1.009 0 1.983.209 2.887.556.87.416 1.635.937 2.296 1.562a8.635 8.635 0 0 1 1.53 2.36A6.88 6.88 0 0 1 7.27 16h2.956a9.385 9.385 0 0 0-.835-3.957 10.67 10.67 0 0 0-2.156-3.262 10.585 10.585 0 0 0-3.2-2.152A11.144 11.144 0 0 0 0 5.83zM0 0v2.95c1.809 0 3.513.347 5.078 1.007 1.6.659 3.026 1.596 4.174 2.81a12.813 12.813 0 0 1 2.818 4.131A13.09 13.09 0 0 1 13.078 16H16c0-2.221-.383-4.304-1.252-6.213a16.119 16.119 0 0 0-3.444-5.102A15.644 15.644 0 0 0 0 0z"/>
</svg>
</i>
&nbsp;&nbsp;RSS&nbsp;订阅</a>
    </div>
    
    
    <div class="author-link-wrap">
      
      <div class="author-link">
        <a href="https://www.zhihu.com/people/faeli" target="_black">知乎</a>
      </div>
      
      <div class="author-link">
        <a href="https://www.jianshu.com/u/b2df47bf6d97" target="_black">简书</a>
      </div>
      
      <div class="author-link">
        <a href="https://www.yuque.com/faeli" target="_black">语雀</a>
      </div>
      
      <div class="author-link">
        <a href="https://space.bilibili.com/385940640" target="_black">哔哩</a>
      </div>
      
    </div>
    
    
    
  </div>
</section>

    
 
  </div>
</aside>
</div>

  </main>
  <footer>
    <div class="footer-inner">
<div></div>
<p class="copyright">
  
  <span>
    由&nbsp;<a href="https://gohugo.io" target="_blank">Hugo</a>&nbsp;强力驱动
  </span>
  <span>&nbsp;
<i class="inline-svg" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
    <path d="M14.715 2.288A4.381 4.381 0 0 0 11.596 1a4.381 4.381 0 0 0-3.119 1.288l-.474.474-.475-.474A4.381 4.381 0 0 0 4.409 1 4.416 4.416 0 0 0 1.29 8.526l6.288 6.288a.6.6 0 0 0 .849 0l6.288-6.288a4.381 4.381 0 0 0 1.288-3.119 4.381 4.381 0 0 0-1.288-3.119z"/>
</svg>
</i>
&nbsp;</span>
  <span
    >主题&nbsp;-
    <a href="https://github.com/faeli/hugo-theme-zero/" target="_blank">Zero</a>
  </span>
</p>
</div>
  </footer><script src="/js/zero.js"></script>

</body>

</html>
